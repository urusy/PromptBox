# ADR-0001: FastAPIと非同期処理の採用

## ステータス

採用

## コンテキスト

Prompt Boxは画像管理Webアプリケーションであり、以下の要件がある：

1. 大量の画像ファイルを扱う
2. 画像メタデータの読み取りはI/Oバウンド処理
3. データベース操作も頻繁に発生
4. ファイル監視（watchdog）によるバックグラウンド処理が必要
5. 将来的なスケーラビリティを考慮

Pythonの主要なWebフレームワークとして、以下を検討した：

- Flask
- Django
- FastAPI

## 決定

**FastAPI** をWebフレームワークとして採用し、**SQLAlchemy 2.0の非同期機能**（asyncpg）を使用する。

### 理由

1. **パフォーマンス**: FastAPIはASGIベースで、非同期I/O処理に最適化されている
2. **型安全性**: PydanticによるリクエストバリデーションとOpenAPI自動生成
3. **開発効率**: 自動ドキュメント生成（Swagger UI / ReDoc）
4. **非同期ネイティブ**: async/awaitによる自然な非同期コード記述
5. **コミュニティ**: 活発な開発と豊富なエコシステム

## 結果

### 良い影響

- I/Oバウンド処理（ファイル読み取り、DB操作）の効率的な処理
- 高い並行処理能力
- 型ヒントによるコード品質向上
- 自動生成されるAPIドキュメント

### 悪い影響

- 非同期プログラミングの学習コスト
- 同期ライブラリとの統合時に注意が必要
- デバッグが同期コードより複雑になる場合がある

## 代替案

### Flask
- 軽量で学習コストが低い
- しかし非同期サポートが限定的
- 型ヒントのサポートが弱い

### Django
- フルスタックで機能が豊富
- しかしオーバーヘッドが大きい
- 非同期サポートは後発で追加されたもの

## 参考

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [SQLAlchemy Async](https://docs.sqlalchemy.org/en/20/orm/extensions/asyncio.html)
